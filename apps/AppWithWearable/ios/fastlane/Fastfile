# This file contains the fastlane.tools configuration
# You can find the documentation at https://docs.fastlane.tools
#
# For a list of all available actions, check out
#
#     https://docs.fastlane.tools/actions
#
# For a list of all available plugins, check out
#
#     https://docs.fastlane.tools/plugins/available-plugins
#

# Uncomment the line if you want fastlane to automatically update itself
# update_fastlane

# default_platform(:ios)

# platform :ios do
#   desc "Build and upload to TestFlight"
#   lane :custom_lane do
#     match(
#       type: "appstore",
#       readonly: true,
#       git_url: "git@github.com:Craftech360-projects/fastlane.git",
#       app_identifier: "com.craftech360.avm"
#     )
#     # Ensure you have the correct certificates and profiles
    
#     build_app(
#       scheme: "Runner",
#       export_options: {
#         provisioningProfiles: {
#           "com.craftech360.avm" => "match AppStore com.craftech360.avm"
#         }
#       },
#       export_xcargs: "-allowProvisioningUpdates" # Allow provisioning updates
#     )
    
#     pilot( # Upload your app to TestFlight using Pilot
#       username: "apps.cft360@gmail.com", # Replace with your Apple ID
#       app_identifier: "com.craftech360.avm", # Replace with your app's bundle identifier
#       changelog: "Testing circle ci and fastlane" # Provide your changelog
#     )
#   end
# end

# default_platform(:ios)
# before_all do
#   setup_circle_ci
# end

# platform :ios do
#   desc "Build and upload to TestFlight"
#   lane :custom_lane do
#     increment_build_number(xcodeproj: "Runner.xcodeproj")
#     match(
#       type: "adhoc",
#       readonly: true,
#       git_url: "git@github.com:Craftech360-projects/fastlane.git",
#       app_identifier: "com.craftech360.avm",
#       username: ENV['FASTLANE_USER'],
#       keychain_name: "login.keychain",
#       keychain_password: ENV["MATCH_PASSWORD"]
#     )
#     sh("flutter build ios --release --no-codesign")
#     upload_to_testflight(skip_waiting_for_build_processing: true)
#   end
# end

##updated code






##28/06
##for circle ci

# default_platform :ios

# platform :ios do
#   before_all do
#     setup_circle_ci
#   end

#   desc "Upload to TestFlight"
#   lane :upload_testflight do
#     increment_build_number(
#       build_number: "$CIRCLE_BUILD_NUM"
#     )
#     match(type: "adhoc")
#     gym(scheme: "Runner")
#     app_store_connect_api_key(
#       key_id: ENV["APP_STORE_CONNECT_API_KEY_KEY_ID"],
#       issuer_id: ENV["APP_STORE_CONNECT_API_KEY_ISSUER_ID"],
#       key: ENV["APP_STORE_CONNECT_API_KEY_KEY"]
#     )
#     pilot(
#       distribute_external: true,
#       notify_external_testers: true,
     
#       changelog: "This is another new build from CircleCI!"
#     )
#   end
# end

##CREATED MATCH FILE FOR ADHOC , NEED TO CREATE FILE FOR  APPSTORE



##for bitrate


# default_platform :ios

# platform :ios do
#   before_all do
#     # No need for setup_circle_ci, adjust any necessary setup here
#   end

#   desc "Upload to TestFlight"
#   lane :upload_testflight do
#     increment_build_number(
#       build_number: ENV["BITRISE_BUILD_NUMBER"]
#     )
#     match(type: "adhoc")
#     gym(scheme: "Runner")
#     app_store_connect_api_key(
#       key_id: ENV["APP_STORE_CONNECT_API_KEY_KEY_ID"],
#       issuer_id: ENV["APP_STORE_CONNECT_API_KEY_ISSUER_ID"],
#       key: ENV["APP_STORE_CONNECT_API_KEY_KEY"]
#     )
#     pilot(
#       distribute_external: true,
#       notify_external_testers: true,
#       changelog: "This is another new build from Bitrise!"
#     )
#   end
# end



default_platform :ios

platform :ios do
 

  desc "Upload to TestFlight"
  lane :upload_testflight do
    increment_build_number(
      build_number: ENV["BITRISE_BUILD_NUMBER"]
    )
    match(type: "adhoc")
    gym(scheme: "Runner")
    app_store_connect_api_key(
      key_id: ENV["APP_STORE_CONNECT_API_KEY_KEY_ID"],
      issuer_id: ENV["APP_STORE_CONNECT_API_KEY_ISSUER_ID"],
      key: ENV["APP_STORE_CONNECT_API_KEY_KEY"]
    )
    pilot(
      distribute_external: true,
      notify_external_testers: true,
      changelog: "This is another new build from Bitrise!"
    )
  end
end

